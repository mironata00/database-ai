# =============================================================================
# DATABASE AI - Production Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# APPLICATION SETTINGS
# -----------------------------------------------------------------------------
APP_NAME=DatabaseAI
APP_VERSION=1.0.0
APP_ENV=production
DEBUG=false
API_PORT=49351
FRONTEND_PORT=49349

# API Configuration
API_HOST=0.0.0.0
API_WORKERS=4
API_RELOAD=false

# CORS - добавь свои домены
CORS_ORIGINS=["http://42b79e5f4529.vps.myjino.ru:49349","http://42b79e5f4529.vps.myjino.ru:49351","http://localhost:3000","http://localhost:8000"]
CORS_CREDENTIALS=true

# Security - НОВЫЕ СГЕНЕРИРОВАННЫЕ КЛЮЧИ
SECRET_KEY=a56-Pz_ZjYTVYRp00XmUazW3lG2foEzHUR_xuYN21aI
JWT_SECRET_KEY=PWJJvf_KHFkeXJsFShni9S0lo1IVzjdk93SxK7j_qGc
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=1440
REFRESH_TOKEN_EXPIRE_DAYS=30

# Encryption for sensitive data
ENCRYPTION_KEY=Tb7c407YC1U2ME6IGkpeSzgd0F7VhD78IDJb7OBbZek=

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_EXTERNAL_REGISTRATION=10

# -----------------------------------------------------------------------------
# POSTGRESQL SETTINGS
# -----------------------------------------------------------------------------
POSTGRES_HOST=postgres_master
POSTGRES_PORT=5432
POSTGRES_DB=database_ai
POSTGRES_USER=postgres
POSTGRES_PASSWORD=db_ai_secure_password_2024
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_MAX_CONNECTIONS=50

# Read Replica (for search queries)
POSTGRES_REPLICA_ENABLED=false
POSTGRES_REPLICA_HOST=postgres_replica
POSTGRES_REPLICA_PORT=5432

# Connection Pool
POSTGRES_POOL_SIZE=20
POSTGRES_MAX_OVERFLOW=40
POSTGRES_POOL_TIMEOUT=30
POSTGRES_POOL_RECYCLE=3600

# Database Extensions
POSTGRES_EXTENSIONS=pg_trgm,btree_gin,btree_gist

# -----------------------------------------------------------------------------
# ELASTICSEARCH SETTINGS
# -----------------------------------------------------------------------------
ES_HOST=elasticsearch
ES_PORT=9200
ES_SCHEME=http
ES_SECURITY_ENABLED=false
ES_USERNAME=elastic
ES_PASSWORD=elastic

# Cluster Configuration
ES_CLUSTER_NAME=database-ai-cluster
ES_HEAP_SIZE=512m
ES_NODES=1

# Index Settings
ES_INDEX_PRODUCTS=products
ES_INDEX_SHARDS=3
ES_INDEX_REPLICAS=1
ES_REFRESH_INTERVAL=1s

# Search Configuration - CRITICAL SETTINGS
ES_SEARCH_STRATEGY=precise
ES_SEARCH_FUZZINESS=AUTO
ES_SEARCH_MIN_SCORE=0.5
ES_SEARCH_BOOST_EXACT_SKU=10.0
ES_SEARCH_BOOST_BRAND=8.0
ES_SEARCH_BOOST_SKU_PARTIAL=5.0
ES_SEARCH_BOOST_TAGS=4.0
ES_SEARCH_BOOST_NAME=3.0
ES_SEARCH_MAX_RESULTS=1000
ES_SEARCH_AGGREGATION_SIZE=1000

# Performance
ES_BULK_SIZE=500
ES_BULK_TIMEOUT=30
ES_REQUEST_TIMEOUT=30
ES_MAX_RETRIES=3

# -----------------------------------------------------------------------------
# REDIS SETTINGS
# -----------------------------------------------------------------------------
REDIS_HOST=redis_master
REDIS_PORT=6379
REDIS_PASSWORD=redis_secure_password_2024
REDIS_DB=0
REDIS_MAX_MEMORY=512mb

# Cache TTL (seconds)
REDIS_CACHE_TTL_SHORT=300
REDIS_CACHE_TTL_MEDIUM=1800
REDIS_CACHE_TTL_LONG=3600
REDIS_CACHE_ENABLED=true

# Redis Sentinel (High Availability)
REDIS_SENTINEL_ENABLED=false
REDIS_SENTINEL_MASTER_NAME=mymaster
REDIS_SENTINEL_HOSTS=redis_sentinel:26379

# -----------------------------------------------------------------------------
# CELERY SETTINGS
# -----------------------------------------------------------------------------
CELERY_BROKER_URL=redis://:redis_secure_password_2024@redis_master:6379/0
CELERY_RESULT_BACKEND=redis://:redis_secure_password_2024@redis_master:6379/1

# Worker Configuration
CELERY_EMAIL_CONCURRENCY=4
CELERY_PARSING_CONCURRENCY=2
CELERY_SEARCH_CONCURRENCY=4
CELERY_LOG_LEVEL=INFO

# Task Settings
CELERY_TASK_SOFT_TIME_LIMIT=600
CELERY_TASK_HARD_TIME_LIMIT=900
CELERY_TASK_ACKS_LATE=true
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_TASK_REJECT_ON_WORKER_LOST=true

# Queue Priorities
CELERY_QUEUE_EMAIL=email_queue
CELERY_QUEUE_PARSING=parsing_queue
CELERY_QUEUE_SEARCH=search_queue

# Scheduled Tasks (Cron)
CELERY_BEAT_IMAP_CHECK_INTERVAL=300
CELERY_BEAT_ES_REINDEX_INTERVAL=86400
CELERY_BEAT_CLEANUP_OLD_FILES_INTERVAL=43200

# Flower Monitoring
FLOWER_PORT=5555
FLOWER_BASIC_AUTH=admin:flower_password_change_me

# -----------------------------------------------------------------------------
# MINIO / S3 STORAGE
# -----------------------------------------------------------------------------
MINIO_ENABLED=true
MINIO_HOST=minio
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minio_secure_password_2024
MINIO_SECURE=false

# Buckets
MINIO_BUCKET_PRICELISTS=pricelists
MINIO_BUCKET_EMAIL_ATTACHMENTS=email-attachments
MINIO_BUCKET_EXPORTS=exports

# File Storage Strategy
STORAGE_KEEP_ORIGINAL_FILES=true
STORAGE_KEEP_PARSED_FILES=true
STORAGE_FILE_RETENTION_DAYS=365
STORAGE_AUTO_CLEANUP_ENABLED=true

# File Size Limits (bytes)
STORAGE_MAX_FILE_SIZE=104857600
STORAGE_MAX_EMAIL_ATTACHMENT_SIZE=52428800

# Alternative S3 (AWS/Yandex/etc)
S3_ENABLED=false
S3_ENDPOINT_URL=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=
S3_REGION=
S3_BUCKET=

# -----------------------------------------------------------------------------
# EMAIL SETTINGS - IMAP (Receiving)
# -----------------------------------------------------------------------------
EMAIL_IMAP_ENABLED=false
EMAIL_IMAP_HOST=imap.gmail.com
EMAIL_IMAP_PORT=993
EMAIL_IMAP_USER=your-email@gmail.com
EMAIL_IMAP_PASSWORD=your-app-password
EMAIL_IMAP_USE_SSL=true
EMAIL_IMAP_FOLDER=INBOX
EMAIL_IMAP_FORWARDING_ADDRESS=suppliers@yourdomain.com

# IMAP Processing
EMAIL_IMAP_CHECK_INTERVAL=300
EMAIL_IMAP_BATCH_SIZE=50
EMAIL_IMAP_MARK_AS_READ=true
EMAIL_IMAP_ARCHIVE_PROCESSED=true
EMAIL_IMAP_ARCHIVE_FOLDER=Processed

# Email Filtering
EMAIL_IMAP_ALLOWED_SENDERS=
EMAIL_IMAP_BLOCKED_SENDERS=
EMAIL_IMAP_SUBJECT_KEYWORDS=прайс,price,каталог,catalog

# -----------------------------------------------------------------------------
# EMAIL SETTINGS - SMTP (Sending)
# -----------------------------------------------------------------------------
EMAIL_SMTP_ENABLED=false
EMAIL_SMTP_HOST=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_SMTP_USER=your-email@gmail.com
EMAIL_SMTP_PASSWORD=your-app-password
EMAIL_SMTP_USE_TLS=true
EMAIL_SMTP_FROM_NAME=Ваша Компания
EMAIL_SMTP_FROM_EMAIL=your-email@gmail.com

# Sending Limits
EMAIL_SMTP_RATE_LIMIT_PER_MINUTE=30
EMAIL_SMTP_RATE_LIMIT_PER_HOUR=500
EMAIL_SMTP_MAX_RECIPIENTS_PER_EMAIL=1
EMAIL_SMTP_RETRY_ATTEMPTS=3
EMAIL_SMTP_RETRY_DELAY=300

# Email Tracking
EMAIL_TRACKING_ENABLED=false
EMAIL_TRACKING_DOMAIN=track.yourdomain.com

# -----------------------------------------------------------------------------
# AI / LLM SETTINGS
# -----------------------------------------------------------------------------
AI_ENABLED=false
AI_PROVIDER=openai
AI_MODEL=gpt-4o
AI_API_KEY=your-openai-api-key
AI_API_BASE_URL=https://api.openai.com/v1
AI_MAX_TOKENS=4000
AI_TEMPERATURE=0.1
AI_TIMEOUT=60

# AI Processing Strategy
AI_AUTO_PARSE_ENABLED=false
AI_FALLBACK_ON_PARSING_ERROR=true
AI_BATCH_PROCESSING=true
AI_BATCH_SIZE=100

# Cost Control
AI_MAX_REQUESTS_PER_DAY=1000
AI_DAILY_COST_LIMIT_USD=50

# -----------------------------------------------------------------------------
# FILE PARSING SETTINGS
# -----------------------------------------------------------------------------
PARSING_STRATEGY=hybrid
PARSING_ENABLED_FORMATS=xlsx,xls,csv,pdf,txt,zip
PARSING_MAX_ROWS_PER_FILE=100000
PARSING_AUTO_DETECT_ENCODING=true
PARSING_DEFAULT_ENCODING=utf-8

# PDF Processing
PARSING_PDF_USE_OCR=true
PARSING_PDF_OCR_LANGUAGE=rus+eng
PARSING_PDF_DPI=300

# Excel Processing
PARSING_EXCEL_READ_SHEETS=all
PARSING_EXCEL_SKIP_EMPTY_ROWS=true
PARSING_EXCEL_HEADER_ROW_AUTO=true

# Column Detection
PARSING_COLUMN_DETECTION_MODE=auto
PARSING_REQUIRED_COLUMNS=sku,name,price

# Column Synonyms (варианты названий колонок для автоопределения)
PARSING_COLUMN_SKU_SYNONYMS=sku|артикул|код|article|арт|код товара|артикул товара|vendor code|item code|part number|партномер|каталожный номер
PARSING_COLUMN_NAME_SYNONYMS=name|наименование|название|товар|продукт|описание|product|item|description|номенклатура|материал
PARSING_COLUMN_PRICE_SYNONYMS=price|цена|стоимость|прайс|cost|розница|опт|розничная цена|оптовая цена|price rub|цена руб
PARSING_COLUMN_BRAND_SYNONYMS=brand|бренд|производитель|марка|manufacturer|vendor|поставщик|завод
PARSING_COLUMN_CATEGORY_SYNONYMS=category|категория|группа|раздел|тип|вид|class|group|подгруппа
PARSING_COLUMN_UNIT_SYNONYMS=unit|ед|единица|единица измерения|ед.изм|measure|uom
PARSING_COLUMN_STOCK_SYNONYMS=stock|остаток|наличие|количество|qty|available|в наличии|склад

# Дополнительные настройки детекции
PARSING_COLUMN_FUZZY_MATCHING=true
PARSING_COLUMN_MIN_CONFIDENCE=0.7
PARSING_COLUMN_USE_POSITION_HINTS=true

# Data Normalization
PARSING_NORMALIZE_BRANDS=true
PARSING_NORMALIZE_CATEGORIES=true
PARSING_GENERATE_TAGS_AUTO=true
PARSING_MAX_TAGS_PER_SUPPLIER=500

# -----------------------------------------------------------------------------
# SEARCH & INDEXING SETTINGS
# -----------------------------------------------------------------------------
SEARCH_MODE=elasticsearch
SEARCH_FALLBACK_TO_POSTGRES=true
SEARCH_CACHE_RESULTS=true
SEARCH_CACHE_TTL=1800

# Indexing Strategy
INDEX_STRATEGY=incremental
INDEX_BATCH_SIZE=1000
INDEX_ON_SUPPLIER_CREATE=true
INDEX_ON_PRODUCT_UPDATE=true
INDEX_REINDEX_SCHEDULE=0 2 * * *

# Full Reindex
INDEX_FULL_REINDEX_ENABLED=false
INDEX_FULL_REINDEX_KEEP_OLD=true

# -----------------------------------------------------------------------------
# AUDIT & LOGGING
# -----------------------------------------------------------------------------
AUDIT_LOG_ENABLED=true
AUDIT_LOG_ACTIONS=create,update,delete,login,export
AUDIT_LOG_RETENTION_DAYS=365

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE_ENABLED=true
LOG_FILE_PATH=/app/logs/app.log
LOG_FILE_MAX_SIZE=10485760
LOG_FILE_BACKUP_COUNT=10

# Sentry Error Tracking
SENTRY_ENABLED=false
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1

# -----------------------------------------------------------------------------
# BACKUP & DISASTER RECOVERY
# -----------------------------------------------------------------------------
BACKUP_ENABLED=false
BACKUP_POSTGRES_SCHEDULE=0 3 * * *
BACKUP_ES_SNAPSHOT_SCHEDULE=0 4 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=backups

# -----------------------------------------------------------------------------
# NGINX / REVERSE PROXY
# -----------------------------------------------------------------------------
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443
NGINX_CLIENT_MAX_BODY_SIZE=100M
NGINX_PROXY_TIMEOUT=300

# SSL
NGINX_SSL_ENABLED=false
NGINX_SSL_CERTIFICATE_PATH=/etc/nginx/ssl/cert.pem
NGINX_SSL_CERTIFICATE_KEY_PATH=/etc/nginx/ssl/key.pem

# -----------------------------------------------------------------------------
# MONITORING & HEALTH CHECKS
# -----------------------------------------------------------------------------
HEALTH_CHECK_ENABLED=true
HEALTH_CHECK_INTERVAL=30
METRICS_ENABLED=false
METRICS_PORT=9090

# Prometheus
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# Grafana
GRAFANA_ENABLED=false
GRAFANA_PORT=3001

# -----------------------------------------------------------------------------
# BUSINESS LOGIC SETTINGS
# -----------------------------------------------------------------------------
# Supplier Status Flow
SUPPLIER_DEFAULT_STATUS=pending
SUPPLIER_AUTO_APPROVE=false
SUPPLIER_BLACKLIST_ENABLED=true

# Rating System
RATING_MIN_VALUE=1
RATING_MAX_VALUE=5
RATING_REQUIRED_COMMENT_ON_LOW=true
RATING_LOW_THRESHOLD=3

# External Registration
EXTERNAL_REGISTRATION_ENABLED=true
EXTERNAL_REGISTRATION_REQUIRE_VERIFICATION=true
EXTERNAL_REGISTRATION_AUTO_IMPORT=false

# Company Settings
COMPANY_NAME=Ваша Компания
COMPANY_INN=
COMPANY_EMAIL=info@yourcompany.ru
COMPANY_PHONE=+7 (xxx) xxx-xx-xx
COMPANY_WEBSITE=https://yourcompany.ru

# -----------------------------------------------------------------------------
# FEATURE FLAGS
# -----------------------------------------------------------------------------
FEATURE_EMAIL_TEMPLATES=true
FEATURE_EMAIL_CAMPAIGNS=true
FEATURE_EMAIL_REPLY_PARSING=true
FEATURE_ADVANCED_SEARCH=true
FEATURE_SUPPLIER_RATINGS=true
FEATURE_AUDIT_LOG=true
FEATURE_EXPORT_EXCEL=true
FEATURE_EXPORT_PDF=true
FEATURE_EXTERNAL_REGISTRATION=true
FEATURE_IMAP_AUTO_IMPORT=false
FEATURE_AI_PARSING=false

# -----------------------------------------------------------------------------
# DEVELOPMENT / TESTING
# -----------------------------------------------------------------------------
DEV_SEED_DATABASE=false
DEV_MOCK_EMAIL=false
DEV_SKIP_AUTH=false
TEST_MODE=false
